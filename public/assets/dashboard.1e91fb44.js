(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{427:function(e,a,t){"use strict";t.r(a);var r=t(1),s=t(0),n=t.n(s),l=t(28),c=t(254),m=t(56),o=t(29),i=t(18),u=t(184),d=t(25),g=t(172),p=t(54),b=t(176),E=t(255),y=t(24),v=t(218);const x=(e,a)=>a>0&&e/(1024*a*1024)>=.9;var f=Object(r.c)("div").withConfig({displayName:"ServerRow___StyledDiv",componentId:"sc-1w8s0p-0"})(["",""],(e=>e.$_css)),h=t(61),N=t(162),w=t(2),j=t(256),k=t(62),O=t(183),_=t(257),S=()=>{const{t:e}=Object(y.c)("dashboard/index"),{search:a}=Object(l.g)(),t=Number(new URLSearchParams(a).get("page")||"1"),[r,m]=Object(s.useState)(!isNaN(t)&&t>0?t:1),{clearFlashes:o,clearAndAddHttpError:i}=Object(N.a)(),u=Object(w.useStoreState)((e=>e.user.data.uuid)),g=Object(w.useStoreState)((e=>e.user.data.rootAdmin)),[E,v]=Object(j.a)("".concat(u,":show_all_servers"),!1),{data:x,error:f}=Object(O.a)(["/api/client/servers",E&&g,r],(()=>Object(c.a)({page:r,type:E&&g?"admin":void 0})));return Object(s.useEffect)((()=>{x&&x.pagination.currentPage>1&&!x.items.length&&m(1)}),[null==x?void 0:x.pagination.currentPage]),Object(s.useEffect)((()=>{window.history.replaceState(null,document.title,"/".concat(r<=1?"":"?page=".concat(r)))}),[r]),Object(s.useEffect)((()=>{f&&i({key:"dashboard",error:f}),f||o("dashboard")}),[f]),n.a.createElement(h.a,{className:"pr-2",title:e("title"),showFlashKey:"dashboard"},n.a.createElement("div",{className:"grid lg:grid-cols-2 gap-2 py-4"},n.a.createElement("div",null,n.a.createElement(b.a,{className:"text-4xl"},e("title"))),g&&n.a.createElement("div",{className:"flex lg:justify-end justify-center"},n.a.createElement("div",{className:"mb-2 pt-4"},n.a.createElement("div",{className:"flex lg:justify-end sm:justify-center items-center space-x-2"},n.a.createElement("p",{className:"uppercase text-xs text-gray-400"},e(E?"other-servers":"your-servers")),n.a.createElement(k.a,{name:"show_all_servers",defaultChecked:E,onChange:()=>v((e=>!e))}))))),x?n.a.createElement("div",{className:"grid lg:grid-cols-2 gap-3"},n.a.createElement(_.a,{data:x,onPageSelect:m},(a=>{let{items:t}=a;return t.length>0?t.map(((e,a)=>n.a.createElement(I,{key:e.uuid,server:e,$_css:a>0?{marginTop:"0.5rem"}:void 0}))):n.a.createElement(C,null,n.a.createElement("p",{className:"flex justify-center text-center text-sm text-gray-400"},n.a.createElement(p.o,{className:"w-5 h-5 mr-1"})," ",e(E?"no-other-servers":"no-servers")))}))):n.a.createElement(d.a,{centered:!0,size:"large"}))},I=Object(r.c)((e=>{let{server:a}=e;const{t:t}=Object(y.c)("dashboard/index"),r=Object(s.useRef)(null),[c,h]=Object(s.useState)("suspended"===a.status),[N,w]=Object(s.useState)(null),j=()=>(e=>new Promise(((a,t)=>{i.a.get("/api/client/servers/".concat(e,"/resources")).then((e=>{let{data:{attributes:t}}=e;return a({status:t.current_state,isSuspended:t.is_suspended,memoryUsageInBytes:t.resources.memory_bytes,cpuUsagePercent:t.resources.cpu_absolute,diskUsageInBytes:t.resources.disk_bytes,networkRxInBytes:t.resources.network_rx_bytes,networkTxInBytes:t.resources.network_tx_bytes,uptime:t.resources.uptime})})).catch(t)})))(a.uuid).then((e=>w(e))).catch((e=>console.error(e)));Object(s.useEffect)((()=>{h((null==N?void 0:N.isSuspended)||"suspended"===a.status)}),[null==N?void 0:N.isSuspended,a.status]),Object(s.useEffect)((()=>{if(!c)return j().then((()=>{r.current=setInterval((()=>j()),3e4)})),()=>{r.current&&clearInterval(r.current)}}),[c]);const k={cpu:!1,memory:!1,disk:!1};N&&(k.cpu=0!==a.limits.cpu&&N.cpuUsagePercent>=.9*a.limits.cpu,k.memory=x(N.memoryUsageInBytes,a.limits.memory),k.disk=0!==a.limits.disk&&x(N.diskUsageInBytes,a.limits.disk));const O=0!==a.limits.disk?Object(u.a)(Object(u.c)(a.limits.disk)):"Unlimited",_=0!==a.limits.memory?Object(u.a)(Object(u.c)(a.limits.memory)):"Unlimited",S=0!==a.limits.cpu?a.limits.cpu+" %":"Unlimited",I=c||a.isTransferring||a.status&&!N;return n.a.createElement(l.a,{to:"/server/".concat(a.id)},n.a.createElement(g.a,{className:"!p-0"},n.a.createElement("div",{className:"rounded-ui bg-center bg-cover bg-no-repeat bg-center relative px-6 pt-6 pb-6 z-10",style:{backgroundImage:"url(".concat(a.eggBanner?a.eggBanner:"/coramtix/default-bg.png",")")}},n.a.createElement(f,{className:"z-[-1] absolute inset-0 rounded-ui backdrop-blur-sm",$_css:"background-image: linear-gradient(0deg, rgb(var(--color-700)) 10%, color-mix(in srgb, rgb(var(--color-700)) 35%, transparent) 55%);"}),n.a.createElement("div",{className:"flex items-center justify-between pb-5"},n.a.createElement(b.a,{className:"text-2xl"},a.name),n.a.createElement("span",{className:"py-1 px-3 text-xs font-medium rounded-ui\n                        ".concat("offline"===(null==N?void 0:N.status)?"bg-danger/20 text-danger border border-danger/30":"running"===(null==N?void 0:N.status)?"bg-success/20 text-success border border-success/30":"starting"===(null==N?void 0:N.status)?"bg-amber-500/20 text-amber-400 border border-amber-500/30":"stopping"===(null==N?void 0:N.status)?"bg-orange-500/20 text-orange-400 border border-orange-500/30":"","\n                    ")},"offline"===(null==N?void 0:N.status)?t("server.offline"):"running"===(null==N?void 0:N.status)?t("server.online"):"starting"===(null==N?void 0:N.status)?t("server.starting"):"stopping"===(null==N?void 0:N.status)?t("server.stopping"):"")),n.a.createElement("div",{className:"".concat(I?"flex justify-center items-center min-h-[100px]":"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4"," mt-4")},!N||c?c?n.a.createElement(n.a.Fragment,null,n.a.createElement(E.a,{className:"bg-danger/50 backdrop-blur-sm border border-danger/80"},n.a.createElement("p",null,"suspended"===a.status?t("server.suspended"):t("server.connection-error")))):a.isTransferring||a.status?n.a.createElement(n.a.Fragment,null,n.a.createElement(E.a,{className:"backdrop-blur-sm bg-yellow-500/50 border border-yellow-500/70"},n.a.createElement("span",{className:"w-4 sm:w-5 text-yellow-500"},n.a.createElement(p.p,null)),n.a.createElement("p",null," ",a.isTransferring?t("server.transferring"):"installing"===a.status?t("server.installing"):"restoring_backup"===a.status?t("server.restoring-backup"):t("server.unavailable")))):n.a.createElement(d.a,{size:"small"}):n.a.createElement(n.a.Fragment,null,n.a.createElement(E.a,{className:"backdrop-blur-sm bg-gray-500/20 border border-gray-500/50"},n.a.createElement("span",{className:"w-4 sm:w-5 text-gray-300"},n.a.createElement(p.w,null)),n.a.createElement(v.a,{className:"text-xs sm:text-sm text-gray-100"},a.allocations.filter((e=>e.isDefault)).map((e=>n.a.createElement(n.a.Fragment,{key:e.ip+e.port.toString()},e.alias||Object(u.b)(e.ip),":",e.port))))),n.a.createElement(E.a,{className:"backdrop-blur-sm bg-gray-500/20 border border-gray-500/50"},n.a.createElement("span",{className:"w-4 sm:w-5 text-gray-300"},n.a.createElement(p.h,null)),n.a.createElement("p",{className:k.cpu?"text-danger-50":""},N.cpuUsagePercent.toFixed(2),"%"),n.a.createElement("span",{className:"text-xs sm:text-sm text-gray-300"},"/ ",S)),n.a.createElement(E.a,{className:"backdrop-blur-sm bg-gray-500/20 border border-gray-500/50"},n.a.createElement("span",{className:"w-4 sm:w-5 text-gray-300"},n.a.createElement(m.a,{icon:o.z})),n.a.createElement("p",{className:k.memory?"text-danger-50":""},Object(u.a)(N.memoryUsageInBytes)),n.a.createElement("span",{className:"text-xs sm:text-sm text-gray-300"},"/ ",_)),n.a.createElement(E.a,{className:"backdrop-blur-sm bg-gray-500/20 border border-gray-500/50"},n.a.createElement("span",{className:"w-4 sm:w-5 text-gray-300"},n.a.createElement(p.G,null)),n.a.createElement("p",{className:k.disk?"text-danger-50":""},Object(u.a)(N.diskUsageInBytes)),n.a.createElement("span",{className:"text-xs sm:text-sm text-gray-300"},"/ ",O)))))))})).withConfig({displayName:"DashboardContainer___StyledServerRow",componentId:"sc-4884cp-0"})(["",""],(e=>e.$_css)),C=Object(r.c)(g.a).withConfig({displayName:"DashboardContainer___StyledCard",componentId:"sc-4884cp-1"})({gridColumn:"span 1 / span 1","@media (min-width: 1024px)":{gridColumn:"span 2 / span 2"}}),U=t(60),B=t(258),F=t(16),P=t(299),z=t(282),R=t(300),T=t(204),D=t(283),A=t(36),$=t(303),J=t(284),G=t(285),H=t(286);const K=e=>{let{route:a}=e;const{t:t}=Object(y.c)("routes");return n.a.createElement(l.b,{id:a.name,to:(r=a.path,"/account/".concat(r.replace(/^\/+/,""))),exact:a.exact},n.a.createElement("span",{className:"flex items-center"},a.icon&&n.a.createElement(a.icon,{className:"w-5 mr-1"})," ",a.name?t(a.name):null));var r},L=()=>n.a.createElement(n.a.Fragment,null,P.a.account.filter((e=>!!e.name)).map((e=>n.a.createElement(K,{key:e.path,route:e}))));a.default=()=>{const e=Object(F.h)(),[a,t]=Object(s.useState)(!1),r=Object(w.useStoreState)((e=>e.coramtix.data.logo)),c=Object(w.useStoreState)((e=>{var a;return null===(a=e.coramtix.data)||void 0===a?void 0:a.isUnderMaintenance})),m=Object(w.useStoreState)((e=>{var a;return null===(a=e.user.data)||void 0===a?void 0:a.rootAdmin}));return n.a.createElement(n.a.Fragment,null,c&&!m?n.a.createElement(H.a,null):n.a.createElement(z.a,null,n.a.createElement(R.a,null,n.a.createElement("div",{className:"lg:hidden"},n.a.createElement("button",{onClick:()=>t(!a),className:"text-gray-500 bg-gray-700 p-2 rounded-ui"},a?n.a.createElement(p.P,{className:"w-6 h-6"}):n.a.createElement(p.E,{className:"w-6 h-6"}))),n.a.createElement(T.a,null,n.a.createElement(M,{src:r,alt:"coramtix",onClick:()=>window.location.href="/"}))),n.a.createElement(D.a,null,a&&n.a.createElement("div",{onClick:()=>t(!1),className:"fixed inset-0 z-30 bg-gray-800/40 backdrop-blur-sm transition-all duration-300 ease-in-out lg:hidden"}),n.a.createElement(A.a,{timeout:150,classNames:"fade"},n.a.createElement($.a,{isOpen:a,dashboard:!0},n.a.createElement(L,null))),n.a.createElement("div",{className:"w-full flex-1 overflow-y-auto"},n.a.createElement(B.a,null,n.a.createElement(n.a.Suspense,{fallback:n.a.createElement(d.a,{centered:!0})},n.a.createElement(l.e,{location:e},n.a.createElement(l.c,{path:"/",exact:!0},n.a.createElement(J.a,null),n.a.createElement(G.a,null),n.a.createElement(S,null)),P.a.account.map((e=>{let{path:a,component:t}=e;return n.a.createElement(l.c,{key:a,path:"/account/".concat(a).replace("//","/"),exact:!0},n.a.createElement(t,null))})),n.a.createElement(l.c,{path:"*"},n.a.createElement(U.a,null)))))))))};var M=Object(r.c)("img").withConfig({displayName:"DashboardRouter___StyledImg",componentId:"sc-eh4ks1-0"})({height:"3rem",marginTop:"1.25rem",cursor:"pointer"})}}]);